<!doctype html>
<html lang="km">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./cdcicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CDC Computer - Invoice System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;600;700&family=Moul&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-blue: #1e3a8a;
        --accent-blue: #2563eb;
      }
      body {
        font-family: "Kantumruy Pro", sans-serif;
        background-color: #f1f5f9;
        color: #1e293b;
        margin: 0;
        padding: 0;
      }
      .kh-moul {
        font-family: "Moul", serif;
      }

      /* Layout Optimization for A4 */
      #invoice-card {
        width: 210mm;
        min-height: 297mm;
        background: white;
        padding: 10mm;
        margin: 20px auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        position: relative;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }

      @media print {
        img {
          display: block !important;
        }
        @page {
          size: A4;
          margin: 0;
        }
        body {
          background: white;
          padding: 0;
          margin: 0;
        }
        .no-print {
          display: none !important;
        }
        #invoice-card {
          box-shadow: none !important;
          margin: 0 !important;
          border: none !important;
          width: 210mm;
          height: 297mm;
          padding: 9mm;
          overflow: hidden;
        }
        /* High fidelity text rendering */
        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }
      }

      .input-edit {
        border: 1px solid transparent;
        background: transparent;
        transition: all 0.2s;
        border-radius: 4px;
        padding: 2px 4px;
      }
      .input-edit:hover:not(:disabled) {
        background: #f8fafc;
        border-color: #e2e8f0;
      }
      .input-edit:focus {
        background: white;
        border-color: var(--accent-blue);
        outline: none;
      }

      .table-header {
        background-color: var(--primary-blue) !important;
        color: white !important;
      }

      #logo-preview {
        max-width: 140px;
        max-height: 80px;
        object-fit: cover;
      }

      /* Responsive table content */
      .item-row input {
        font-size: 13px;
      }

      .total-section {
        background-color: #f8fafc;
        border-radius: 12px;
      }

      .input-multiline {
        width: 100%;
        background: transparent;
        border: none;
        outline: none;
        resize: none;
        overflow: hidden;
        display: block;
        min-height: 1.5em;
        line-height: 1.5;
      }

      .table-header {
        background-color: var(--primary-blue) !important;
        color: white !important;
      }
    </style>
  </head>
  <body class="py-10">
    <!-- Navbar Controls -->
    <div
      class="no-print fixed top-5 left-1/2 -translate-x-1/2 z-50 w-full max-w-[900px] px-4"
    >
      <div
        class="bg-white/90 backdrop-blur-md p-3 rounded-2xl shadow-xl border border-slate-200 flex items-center justify-between"
      >
        <div class="flex items-center">
          <button
            onclick="removeLastRow()"
            class="text-orange-600 font-bold p-2 hover:bg-orange-50 rounded-xl transition-all"
          >
            លុបជួរចុងក្រោយ
          </button>
          <button
            onclick="clearAllRows()"
            class="text-red-700 font-bold p-2 hover:bg-red-50 rounded-xl transition-all"
          >
            លុបទាំងអស់
          </button>
        </div>

        <div class="flex gap-2 items-center">
          <div>
            <a
              href="index.html"
              class="hover:bg-red-50 transition-all text-red-700 p-[5px] py-3 rounded-[15px] font-bold"
              >ត្រឡប់ក្រោយ</a
            >
          </div>
          <button
            onclick="addSixRows()"
            class="text-blue-700 text-sm font-bold p-1 py-2 px-3 hover:bg-blue-50 rounded-xl transition-all border border-blue-100"
          >
            បន្ថែម 6 ជួរ
          </button>
          <button
            onclick="addRow()"
            class="px-4 py-2 text-sm font-bold text-blue-700 hover:bg-blue-50 rounded-xl transition-all border border-blue-100"
          >
            + ថែមទំនិញ
          </button>
          <button
            onclick="toggleDateInput()"
            class="px-3 py-2 text-sm font-bold text-purple-700 hover:bg-purple-50 rounded-xl transition-all border border-purple-100"
          >
            ប្តូរទម្រង់ថ្ងៃ (Date/Text)
          </button>
          <button
            onclick="saveAsPDF()"
            class="px-5 py-2 text-xs font-bold text-white bg-blue-700 hover:bg-blue-800 rounded-xl transition-all shadow-lg flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"
              />
            </svg>
            រក្សាទុកជា PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Main Invoice Document -->
    <div id="invoice-card" class="">
      <!-- Header Section -->
      <div class="text-center m-auto mt-[-10px]">
        <h1 class="kh-moul text-4xl text-blue-700 mb-3">វិក្កយបត្រ</h1>
        <p
          class="text-slate-400 font-bold tracking-widest text-4xl mb-4 uppercase"
        >
          Invoice
        </p>
      </div>
      <div class="mb-6 mt-[-110px]">
        <div class="w-3/5">
          <!-- Logo Container -->
          <div class="relative mb-4 cursor-pointer inline-block">
            <div
              class="w-[90px] h-35 border-slate-200 rounded-lg flex flex-col items-center justify-center text-slate-400"
            ></div>
          </div>

          <div class="pr-6 flex justify-between items-center w-[678px]">
            <div class="left">
              <input
                type="text"
                class="text-3xl rounded-[5px] text-blue-700 font-bold hover:bg-gray-50 p-[3px] rounded-[6px] w-[250px] outline-none"
              />
              <div class="text-[13px] font-bold text-slate-800">
                <input
                  type="text"
                  class="outline-none hover:bg-gray-50 text-blue-700 w-[70px] p-[3px] rounded-[6px]"
                />
                <input
                  type="text"
                  class="outline-none hover:bg-gray-50 p-[3px] rounded-[6px]"
                />
              </div>
              <div class="text-[12px] text-slate-600 leading-snug">
                <input
                  type="text"
                  class="outline-none hover:bg-gray-50 font-bold text-blue-700 w-[70px] p-[3px] rounded-[6px]"
                />
                <input
                  type="text"
                  class="t p-[3px] outline-none hover:bg-gray-50 rounded-[6px] w-[350px]"
                />
              </div>
            </div>
            <div class="relative left-[60px]">
              <div class="">
                <div id="date-container" class="top-[30px] relative">
                  <span class="font-bold text-slate-500">Date:</span>
                  <input
                    type="date"
                    id="date-field"
                    class="font-bold text-slate-800 input-edit w-19 text-center"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="mb-6 p-4 bg-blue-50/50 rounded-xl border border-blue-100/50">
        <div class="">
          <h2 class="font-bold">Costumer/Company</h2>
          <div class="flex items-center border-b border-blue-200 pb-1">
            <span class="text-[11px] text-blue-600 w-24 font-bold"
              >អតិថិជន/Name:</span
            >
            <input
              type="text"
              class="text-sm font-bold text-slate-800 input-edit w-full"
            />
          </div>
          <div class="flex items-center border-b border-blue-200 pb-1">
            <span class="text-[11px] text-blue-600 w-24 font-bold"
              >ទូរស័ព្ទ/Tel:</span
            >
            <input
              type="text"
              class="text-sm text-slate-700 input-edit w-full"
            />
          </div>
          <div class="flex items-center border-b border-blue-200 pb-1">
            <span class="text-[11px] text-blue-600 w-24 font-bold"
              >ទីតាំង/Address:</span
            >
            <input
              type="text"
              class="text-sm text-slate-700 input-edit w-full"
            />
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="flex-grow overflow-hidden">
        <table class="w-full border-collapse">
          <thead>
            <tr class="table-header text-[11px] font-bold uppercase">
              <th class="py-3 px-2 text-center border-r border-white/20 w-10">
                <span>ល.រ</span><br />
                <span>No</span>
              </th>
              <th class="py-2 px-3 text-center border-r border-white/20">
                <span>រាយមុខទំនិញ</span><br />
                <span>Name of Goods</span>
              </th>
              <th class="py-3 px-2 text-center border-r border-white/20 w-24">
                <span>ការធានា</span><br />
                <span>Warranty</span>
              </th>
              <th class="py-3 px-2 text-center border-r border-white/20 w-16">
                <span>ចំនួន</span><br />
                <span>Quantity</span>
              </th>
              <th class="py-3 px-3 text-center border-r border-white/20 w-28">
                <span>តម្លៃរាយ</span><br />
                <span>Price</span>
              </th>
              <th class="py-3 px-3 text-right w-28">
                <span>តម្លៃសរុប</span><br />
                <span>Total</span>
              </th>
            </tr>
          </thead>
          <tbody id="item-list">
            <tr class="item-row border-b border-slate-200">
              <td class="py-2 px-1 text-center text-slate-400 text-xs border">
                1
              </td>
              <td class="py-2 px-2 border">
                <textarea
                  class="input-multiline text-sm font-semibold text-slate-700"
                  rows="1"
                  oninput="autoHeight(this)"
                ></textarea>
              </td>
              <td class="py-2 px-1 border">
                <textarea
                  class="input-multiline text-[11px] text-center text-blue-600 font-bold"
                  rows="1"
                  oninput="autoHeight(this)"
                ></textarea>
              </td>
              <td class="py-2 px-1 border">
                <input
                  type="number"
                  oninput="calculateFromPrice(this)"
                  class="qty text-center input-edit text-sm font-bold w-full"
                />
              </td>
              <td class="py-2 px-1 border">
                <input
                  type="number"
                  oninput="calculateFromPrice(this)"
                  class="price text-right input-edit text-sm font-bold w-full text-blue-600"
                />
              </td>
              <td class="py-2 px-1 border">
                <div class="flex items-center">
                  <span class="ml-1 text-slate-500 text-sm">$</span>
                  <input
                    type="number"
                    oninput="calculateGrandTotalOnly()"
                    class="total-row text-right input-edit text-sm font-extrabold text-slate-800 w-full"
                    readonly
                  />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Footer -->
      <div class="mt-6">
        <div class="flex justify-between gap-6 items-start mb-6">
          <!-- Warranty Info -->
          <div class="w-[60%]">
            <div
              class="p-3 bg-slate-50 rounded-xl border border-slate-200 border-dashed"
            >
              <h4 class="text-[10px] font-bold text-blue-900 uppercase mb-2">
                សម្គាល់ និង​ ការធានា / TERMS & WARRANTY
              </h4>
              <ul class="text-[9px] text-slate-600 space-y-1 leading-tight">
                <li>
                  •
                  រាល់ទំនិញដែលអតិថិជនទិញរួចមិនអាចប្តូរយកសាច់ប្រាក់ឬដូរវិញបានឡើយ
                  / Goods are sold no Refund and Return.
                </li>
                <li>
                  • សូមអតិថិជនត្រួតពិនិត្យទំនិញអោយបានច្បាស់លាស់
                  មុនពេលយកទំនិញចេញពីហាង / Please check the goods carefully
                  before leaving the store.
                </li>
                <li class="font-bold text-slate-800">
                  • មិនធានាលើទំនិញដែលបាត់បង់លក្ខណៈដើម ឆេះ ធ្លាក់ បាក់បែក
                  និងចូលទឹក ។
                </li>
                <li>
                  • ការបាត់បង់ ឬរហែក Seal ធានារបស់ហាង
                  និងបាត់វិកយបត្រមិនមានការធានា។
                </li>
              </ul>
            </div>
          </div>

          <!-- Calculation -->
          <div class="w-[35%] space-y-2">
            <div
              class="flex justify-between px-3 py-1.5 border-b border-slate-100 bg-blue-700 text-[17px] rounded-xl"
            >
              <span class="font-bold text-white">សរុប / TOTAL :</span>
              <input
                type="text"
                id="subtotal"
                class="w-20 bg-transparent text-white outline-none border-none px-1 font-bold text-right"
                readonly
              />
            </div>
            <div
              class="flex justify-between px-3 py-1.5 border-b border-slate-100 text-[12px]"
            >
              <span class="font-bold text-slate-500">កក់ / DEPOSIT :</span>
              <input
                type="number"
                id="deposit"
                oninput="calculateGrandTotalOnly()"
                class="text-right input-edit font-extrabold w-20 text-blue-600"
              />
            </div>
            <div
              class="flex justify-between items-center px-3 py-3 text-slate-500"
            >
              <span class="text-[11px] font-bold uppercase"
                >នៅខ្វះ / BALANCE :</span
              >
              <input
                type="text"
                id="balance"
                class="w-20 outline-none border-none font-bold text-gray-800 text-right"
                readonly
              />
            </div>
          </div>
        </div>

        <!-- Signatures -->
        <div class="flex justify-between items-center px-10 mt-10">
          <div class="text-center w-40">
            <p class="kh-moul text-[11px] text-blue-900">អតិថិជន</p>
            <p class="font-bold text-[10px]">Costumer</p>
            <div class="h-8 border-b border-slate-200 mb-2"></div>
          </div>
          <div class="text-center w-40">
            <p class="kh-moul text-[11px] text-blue-900">អ្នកលក់</p>
            <p class="font-bold text-[10px]">Seller</p>
            <div class="h-8 border-b border-slate-200 mb-2"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Auto-height for textareas
      function autoHeight(textarea) {
        textarea.style.height = "auto";
        textarea.style.height = textarea.scrollHeight + "px";
      }

      // Set initial date
      window.onload = function () {
        const dateField = document.getElementById("date-field");
        if (dateField) {
          const now = new Date();
          dateField.value = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, "0")}-${String(now.getDate()).padStart(2, "0")}`;
        }
      };

      let isTextInput = false;

      function toggleDateInput() {
        const container = document.getElementById("date-container");
        const oldField = document.getElementById("date-field");
        isTextInput = !isTextInput;

        if (isTextInput) {
          container.innerHTML = `
            <span class="font-bold text-slate-500">Date:</span>
            <input type="text" id="date-field" class="font-bold text-slate-800 input-edit w-[160px] text-center" />
          `;
        } else {
          container.innerHTML = `
            <span class="font-bold text-slate-500">Date:</span>
            <input type="date" id="date-field" class="font-bold text-slate-800 input-edit w-40 text-center" />
          `;
          const now = new Date().toISOString().split("T")[0];
          document.getElementById("date-field").value = now;
        }
      }

      function addRow() {
        const tbody = document.getElementById("item-list");
        const rowCount = tbody.rows.length + 1;
        const row = document.createElement("tr");
        row.className = "item-row border-b border-slate-200";
        row.innerHTML = `
          <td class="py-2 text-center text-slate-400 text-xs border">${rowCount}</td>
          <td class="p-1 border">
            <textarea class="input-multiline text-sm font-semibold text-slate-700" rows="1" oninput="autoHeight(this)"></textarea>
          </td>
          <td class="p-1 border">
            <textarea class="input-multiline text-[11px] text-center text-blue-600 font-bold" rows="1" oninput="autoHeight(this)"></textarea>
          </td>
          <td class="p-1 border">
            <input type="number" oninput="calculateFromPrice(this)" class="qty input-edit text-center text-sm font-bold w-full">
          </td>
          <td class="p-1 border">
            <input type="number" oninput="calculateFromPrice(this)" class="price input-edit text-right text-sm font-bold text-blue-600 w-full">
          </td>
          <td class="p-1 border">
            <div class="flex items-center justify-end px-1">
              <span class="text-slate-400 text-xs mr-1">$</span>
              <input type="number" class="total-row input-edit text-right text-sm font-extrabold text-slate-800 w-full" readonly>
            </div>
          </td>
        `;
        tbody.appendChild(row);
        calculateGrandTotalOnly();
      }

      function addSixRows() {
        for (let i = 0; i < 6; i++) addRow();
      }

      function removeLastRow() {
        const tbody = document.getElementById("item-list");
        if (tbody.rows.length > 0) {
          tbody.deleteRow(tbody.rows.length - 1);
          calculateGrandTotalOnly();
        }
      }

      function clearAllRows() {
        document.getElementById("item-list").innerHTML = "";
        calculateGrandTotalOnly();
      }

      function calculateFromPrice(element) {
        const row = element.closest("tr");
        const qty = parseFloat(row.querySelector(".qty").value) || 0;
        const price = parseFloat(row.querySelector(".price").value) || 0;
        const totalInput = row.querySelector(".total-row");
        const total = qty * price;
        totalInput.value = total > 0 ? total.toFixed(2) : "";
        calculateGrandTotalOnly();
      }

      function calculateGrandTotalOnly() {
        let subtotal = 0;
        document.querySelectorAll(".total-row").forEach((input) => {
          subtotal += parseFloat(input.value) || 0;
        });

        const deposit =
          parseFloat(document.getElementById("deposit").value) || 0;
        const balance = subtotal - deposit;

        document.getElementById("subtotal").value =
          subtotal > 0 ? "$" + subtotal.toFixed(2) : "";
        document.getElementById("balance").value =
          balance !== 0 ? "$" + balance.toFixed(2) : "";
      }

      function saveAsPDF() {
        window.print();
      }
    </script>
  </body>
</html>
