<!doctype html>
<html lang="km">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./cdcicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CDC Computer - Invoice System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;600;700&family=Moul&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-blue: #1e3a8a;
        --accent-blue: #2563eb;
      }
      body {
        font-family: "Kantumruy Pro", sans-serif;
        background-color: #f1f5f9;
        color: #1e293b;
        margin: 0;
        padding: 0;
      }
      .kh-moul {
        font-family: "Moul", serif;
      }

      /* Layout Optimization for A4 */
      #invoice-card {
        width: 210mm;
        min-height: 297mm;
        background: white;
        padding: 10mm;
        margin: 20px auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        position: relative;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }

      @media print {
        img {
          display: block !important;
        }
        @page {
          size: A4;
          margin: 0;
        }
        body {
          background: white;
          padding: 0;
          margin: 0;
        }
        .no-print {
          display: none !important;
        }
        #invoice-card {
          box-shadow: none !important;
          margin: 0 !important;
          border: none !important;
          width: 210mm;
          height: 297mm;
          padding: 9mm;
          overflow: hidden;
        }
        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }
      }

      .input-edit {
        border: 1px solid transparent;
        background: transparent;
        transition: all 0.2s;
        border-radius: 4px;
        padding: 2px 4px;
      }
      .input-edit:hover:not(:disabled) {
        background: #f8fafc;
        border-color: #e2e8f0;
      }
      .input-edit:focus {
        background: white;
        border-color: var(--accent-blue);
        outline: none;
      }

      .table-header {
        background-color: var(--primary-blue) !important;
        color: white !important;
      }

      /* Responsive table content */
      .item-row input {
        font-size: 13px;
      }
    </style>
  </head>
  <body class="py-10">
    <!-- Navbar Controls -->
    <div
      class="no-print fixed top-5 left-1/2 -translate-x-1/2 z-50 w-full max-w-4xl px-4"
    >
      <div
        class="bg-white/90 backdrop-blur-md p-3 rounded-2xl shadow-xl border border-slate-200 flex items-center justify-between"
      >
        <div class="flex items-center gap-2">
          <a
            href="invoice.html"
            class="text-blue-700 font-bold p-2 hover:bg-blue-50 rounded-xl transition-all"
            >វិក្កយបត្រថ្មី</a
          >
          <button
            onclick="removeLastRow()"
            class="text-orange-600 font-bold p-2 hover:bg-orange-50 rounded-xl transition-all"
          >
            លុបជួរចុងក្រោយ
          </button>
          <button
            onclick="clearAllRows()"
            class="text-red-700 font-bold p-2 hover:bg-red-50 rounded-xl transition-all"
          >
            លុបទាំងអស់
          </button>
        </div>

        <div class="flex gap-2 items-center">
          <button
            onclick="addNineRows()"
            class="text-blue-700 text-sm font-bold p-1 py-2 px-3 hover:bg-blue-50 rounded-xl transition-all border border-blue-100"
          >
            បន្ថែម 6 ជួរ
          </button>
          <button
            onclick="addRow()"
            class="px-3 py-2 text-sm font-bold text-blue-700 hover:bg-blue-50 rounded-xl transition-all border border-blue-100"
          >
            ថែម 1 ជួរ
          </button>
          <button
            onclick="saveAsPDF()"
            class="px-5 py-2 text-xs font-bold text-white bg-blue-700 hover:bg-blue-800 rounded-xl transition-all shadow-lg flex items-center gap-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"
              />
            </svg>
            រក្សាទុកជា PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Main Invoice Document -->
    <div id="invoice-card">
      <!-- Header Section -->
      <div class="text-center m-auto mt-[-10px]">
        <h1 class="kh-moul text-4xl text-blue-700 mb-3">វិក្កយបត្រ</h1>
        <p
          class="text-slate-400 font-bold tracking-widest text-4xl mb-4 uppercase"
        >
          Invoice
        </p>
      </div>

      <div class="mb-6 mt-[-110px]">
        <div class="w-3/5">
          <div class="relative mb-4 inline-block">
            <div
              class="w-[90px] h-35 border-slate-200 rounded-lg flex flex-col items-center justify-center text-slate-400"
            >
              <img
                src="./cdcicon.png"
                class="w-full h-full"
                onerror="
                  this.src = 'https://via.placeholder.com/90x90?text=Logo'
                "
              />
            </div>
          </div>

          <div class="pr-6 flex justify-between items-center w-[678px]">
            <div class="left">
              <h2 class="font-bold text-3xl text-blue-700 mb-1">
                CDC Computer
              </h2>
              <div class="text-[13px] font-bold text-slate-800">
                <span class="text-blue-700">លេខទូរស័ព្ទ៖</span> 099 844 884 /
                093 844 884
              </div>
              <div class="text-[12px] text-slate-600 leading-snug">
                <span class="font-bold text-blue-700">អាសយដ្ឋាន៖</span> ផ្ទះលេខ
                1203 ផ្លូវជាតិលេខ 2 សង្កាត់ចាក់អង្រែលើ ខណ្ឌមានជ័យ ភ្នំពេញ។
              </div>
            </div>
            <div class="relative left-[60px]">
              <div class="relative top-[28px]">
                <span class="font-bold text-slate-500">Date:</span>
                <input
                  type="date"
                  id="date-field"
                  class="font-bold text-slate-800 input-edit w-32 text-center"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="mb-6 p-4 bg-blue-50/50 rounded-xl border border-blue-100/50">
        <h2 class="font-bold mb-2">Customer/Company</h2>
        <div class="space-y-1">
          <div class="flex items-center border-b border-blue-200 pb-1">
            <span class="text-[11px] text-blue-600 w-32 font-bold uppercase"
              >អតិថិជន/Name:</span
            >
            <input
              type="text"
              class="text-sm font-bold text-slate-800 input-edit w-full"
            />
          </div>
          <div class="flex items-center border-b border-blue-200 pb-1">
            <span class="text-[11px] text-blue-600 w-32 font-bold uppercase"
              >ទូរស័ព្ទ/Tel:</span
            >
            <input
              type="text"
              class="text-sm text-slate-700 input-edit w-full"
            />
          </div>
          <div class="flex items-center border-b border-blue-200 pb-1">
            <span class="text-[11px] text-blue-600 w-32 font-bold uppercase"
              >ទីតាំង/Address:</span
            >
            <input
              type="text"
              class="text-sm text-slate-700 input-edit w-full"
            />
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="flex-grow overflow-hidden">
        <table class="w-full border-collapse border border-slate-200">
          <thead>
            <tr class="table-header text-[11px] font-bold uppercase">
              <th class="py-3 px-2 text-center border-r border-white/20 w-10">
                ល.រ<br />No
              </th>
              <th class="py-2 px-3 text-center border-r border-white/20">
                រាយមុខទំនិញ<br />Name of Goods
              </th>
              <th class="py-3 px-2 text-center border-r border-white/20 w-24">
                ការធានា<br />Warranty
              </th>
              <th class="py-3 px-2 text-center border-r border-white/20 w-16">
                ចំនួន<br />Qty
              </th>
              <th class="py-3 px-3 text-center border-r border-white/20 w-28">
                តម្លៃរាយ<br />Unit Price
              </th>
              <th class="py-3 px-3 text-right w-32">តម្លៃសរុប<br />Total</th>
            </tr>
          </thead>
          <tbody id="item-list">
            <!-- Rows injected by JS -->
          </tbody>
        </table>
      </div>

      <!-- Footer Section -->
      <div class="mt-6">
        <div class="flex justify-between gap-6 items-start mb-10">
          <!-- Terms -->
          <div
            class="w-[60%] p-3 bg-slate-50 rounded-xl border border-slate-200 border-dashed"
          >
            <h4 class="text-[10px] font-bold text-blue-900 uppercase mb-2">
              សម្គាល់ និង​ ការធានា / TERMS & WARRANTY
            </h4>
            <ul class="text-[9px] text-slate-600 space-y-1 leading-tight">
              <li>
                • រាល់ទំនិញដែលអតិថិជនទិញរួចមិនអាចប្តូរយកសាច់ប្រាក់ឬដូរវិញបានឡើយ
                / No Refund.
              </li>
              <li>
                • សូមអតិថិជនត្រួតពិនិត្យទំនិញអោយបានច្បាស់លាស់មុនចាកចេញ / Please
                check before leaving.
              </li>
              <li class="font-bold text-slate-800">
                • មិនធានាលើទំនិញដែលបាត់បង់លក្ខណៈដើម ឆេះ ធ្លាក់ បាក់បែក និងចូលទឹក
                ។
              </li>
              <li>• ការបាត់បង់ Seal ធានា ឬ បាត់វិកយបត្រមិនមានការធានាឡើយ។</li>
            </ul>
          </div>

          <!-- Calculation -->
          <div class="w-[35%] space-y-2">
            <div
              class="flex justify-between px-3 py-2 bg-blue-700 text-white rounded-xl items-center"
            >
              <span class="font-bold text-sm">សរុប / TOTAL:</span>
              <span id="subtotal" class="font-extrabold text-lg">$0.00</span>
            </div>
            <div
              class="flex justify-between px-3 py-1 border-b border-slate-100 text-[12px]"
            >
              <span class="font-bold text-slate-500">កក់ / DEPOSIT:</span>
              <div class="flex items-center font-bold text-blue-600">
                <span>$</span>
                <input
                  type="number"
                  id="deposit"
                  oninput="calculate()"
                  class="text-right input-edit w-20 font-extrabold"
                  value="0.00"
                />
              </div>
            </div>
            <div class="flex justify-between items-center px-3 py-1">
              <span class="text-[11px] font-bold text-slate-500 uppercase"
                >នៅខ្វះ / BALANCE:</span
              >
              <span id="balance" class="text-sm font-extrabold text-red-600"
                >$0.00</span
              >
            </div>
          </div>
        </div>

        <!-- Signatures -->
        <div class="flex justify-between items-center px-10 mb-4">
          <div class="text-center w-40">
            <p class="kh-moul text-[11px] text-blue-900">អតិថិជន</p>
            <p class="font-bold text-[10px]">Customer's Signature</p>
            <div class="mt-12 border-b border-slate-200"></div>
          </div>
          <div class="text-center w-40">
            <p class="kh-moul text-[11px] text-blue-900">អ្នកលក់</p>
            <p class="font-bold text-[10px]">Seller's Signature</p>
            <div class="mt-12 border-b border-slate-200"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Date
      const now = new Date();
      document.getElementById("date-field").value = now
        .toISOString()
        .split("T")[0];

      function addRow() {
        const tbody = document.getElementById("item-list");
        const rowCount = tbody.rows.length + 1;
        const row = document.createElement("tr");
        row.className = "item-row border-b border-slate-200";
        row.innerHTML = `
          <td class="py-2 px-1 text-center text-slate-400 text-xs border">${rowCount}</td>
          <td class="py-2 px-2 border">
            <input type="text" class="input-edit text-sm w-full font-semibold text-slate-700" placeholder="">
          </td>
          <td class="py-2 px-1 border">
            <input type="text" class="input-edit text-[11px] w-full text-center text-blue-600 font-bold">
          </td>
          <td class="py-2 px-1 border">
            <input type="number" oninput="updateRowTotal(this)" class="qty text-center input-edit text-sm font-bold w-full" step="any">
          </td>
          <td class="py-2 px-1 border">
            <input type="number" oninput="updateRowTotal(this)" class="price text-right input-edit text-sm font-bold w-full text-blue-600" step="any">
          </td>
          <td class="py-2 px-1 border">
            <div class="flex items-center justify-end">
                <span class="text-slate-400 text-xs mr-1">$</span>
                <input type="number" oninput="calculateGrandTotal()" class="total-row-input text-right input-edit text-sm font-extrabold text-slate-800 w-full" step="any">
            </div>
          </td>
        `;
        tbody.appendChild(row);
      }

      // Update individual row total when Qty or Price changes, but allow manual edit
      function updateRowTotal(input) {
        const row = input.closest("tr");
        const qty = parseFloat(row.querySelector(".qty").value) || 0;
        const price = parseFloat(row.querySelector(".price").value) || 0;
        const totalInput = row.querySelector(".total-row-input");

        if (qty > 0 && price > 0) {
          totalInput.value = (qty * price).toFixed(2);
        }
        calculateGrandTotal();
      }

      // Calculate final sums
      function calculateGrandTotal() {
        let subtotal = 0;
        document.querySelectorAll(".total-row-input").forEach((input) => {
          subtotal += parseFloat(input.value) || 0;
        });

        const deposit =
          parseFloat(document.getElementById("deposit").value) || 0;
        document.getElementById("subtotal").innerText =
          "$" + subtotal.toFixed(2);
        document.getElementById("balance").innerText =
          "$" + (subtotal - deposit).toFixed(2);
      }

      function calculate() {
        calculateGrandTotal();
      }

      function removeLastRow() {
        const tbody = document.getElementById("item-list");
        if (tbody.rows.length > 0) {
          tbody.deleteRow(tbody.rows.length - 1);
          calculateGrandTotal();
        }
      }

      function clearAllRows() {
        if (confirm("តើអ្នកពិតជាចង់លុបទិន្នន័យទាំងអស់មែនទេ?")) {
          document.getElementById("item-list").innerHTML = "";
          addRow();
          document.getElementById("deposit").value = "0.00";
          calculateGrandTotal();
        }
      }

      function addNineRows() {
        for (let i = 0; i < 6; i++) {
          addRow();
        }
      }

      function saveAsPDF() {
        window.print();
      }

      // Initial Rows
      window.onload = () => {
        for (let i = 0; i < 1; i++) addRow();
      };
    </script>
  </body>
</html>
